name: âœï¸ Issue Quality Enhancer

on:
  issues:
    types: [opened]

permissions:
  contents: read
  issues: write

jobs:
  enhance-issue:
    name: âœï¸ Enhance Issue Quality
    runs-on: ubuntu-latest

    steps:
      - name: ðŸ“¥ Checkout repository
        uses: actions/checkout@v4

      - name: ðŸ“¦ Install GitHub Copilot CLI
        run: |
          curl -fsSL https://gh.io/copilot-install | bash
          echo "$HOME/.local/bin" >> $GITHUB_PATH

      - name: âœï¸ Enhance issue title and body
        env:
          GH_TOKEN: ${{ secrets.COPILOT_PAT }}
          ISSUE_NUMBER: ${{ github.event.issue.number }}
          ISSUE_TITLE: ${{ github.event.issue.title }}
          ISSUE_BODY: ${{ github.event.issue.body }}
          ISSUE_AUTHOR: ${{ github.event.issue.user.login }}
        run: |
          export PATH="$HOME/.local/bin:$PATH"

          copilot -p "
          You are an expert Issue Quality Enhancer for the repository '${{ github.repository }}'.
          Your job is to take a newly opened issue and improve its quality so it is clear, detailed,
          well-structured, and consistent with the project standards.

          ISSUE DETAILS:
          - Number: #$ISSUE_NUMBER
          - Author: @$ISSUE_AUTHOR
          - Original Title: $ISSUE_TITLE
          - Original Body: $ISSUE_BODY

          Follow these steps IN ORDER:

          â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
          STEP 1 â€” UNDERSTAND THE PROJECT CONTEXT
          â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
          - Read the repository README to understand what this project is about.
          - Read the AGENTS.md file for additional context about best practices.
          - Scan the source code structure to know what modules, files and technologies exist.
          - Use the GitHub MCP Server to list the last 10 closed and open issues in this repository
            so you can learn the naming conventions, language and structure used.

          â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
          STEP 2 â€” UNDERSTAND THE LABELS
          â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
          - Use the GitHub MCP Server to list ALL available labels in this repository.
          - Save this list â€” you will need it later to assign labels.

          â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
          STEP 3 â€” DETECT LANGUAGE & TRANSLATE
          â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
          - Detect the language of the original title and body.
          - This project uses ENGLISH for all issues.
          - If the title or body are in ANY language other than English (e.g., Spanish, French, etc.),
            translate the content to clear, professional English.
          - Preserve the original meaning and technical details during translation.

          â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
          STEP 4 â€” ENHANCE THE TITLE
          â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
          Create a new, improved title following these rules:
          - Start with a relevant emoji that represents the issue type:
            ðŸ› for bugs, âœ¨ for features/enhancements, ðŸ“ for docs, ðŸŽ¨ for design/visual,
            ðŸ–¼ï¸ for branding, ðŸ for Python code, ðŸ“Š for slides, ðŸ¤– for Copilot skill,
            ðŸŽ­ for agents, ðŸ”¤ for typography, ðŸ–Œï¸ for icons, ðŸ—’ï¸ for speaker notes,
            ðŸ”§ for refactoring, ðŸ“¦ for renderers, ðŸ”’ for security, âš¡ for performance
          - Keep it concise but descriptive (5-12 words after the emoji)
          - Use imperative mood (e.g., 'Add dark mode support' not 'Adding dark mode support')
          - Do NOT include issue type prefixes like '[BUG]' or '[FEATURE]' â€” the emoji replaces those

          â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
          STEP 5 â€” ENHANCE THE BODY
          â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
          Rewrite the issue body using this structure. Adapt sections based on issue type:

          **For Bug Reports:**
          \`\`\`
          ## ðŸ› Description
          Clear description of what's broken.

          ## ðŸ“‹ Steps to Reproduce
          1. Step one
          2. Step two
          3. ...

          ## âœ… Expected Behavior
          What should happen.

          ## âŒ Actual Behavior
          What happens instead.

          ## ðŸ–¥ï¸ Environment (if applicable)
          - OS:
          - Python version:
          - Dependencies:

          ## ðŸ“¸ Screenshots / Logs (if applicable)
          Any relevant output.
          \`\`\`

          **For Feature Requests / Enhancements:**
          \`\`\`
          ## âœ¨ Description
          Clear description of the proposed feature or improvement.

          ## ðŸŽ¯ Motivation
          Why is this needed? What problem does it solve?

          ## ðŸ“ Proposed Solution
          How should this be implemented? Include technical details if possible.

          ## ðŸ”„ Alternatives Considered (if any)
          Other approaches that were considered.

          ## ðŸ“Ž Additional Context
          Links, references, or screenshots.
          \`\`\`

          **For other issue types use a sensible structure with emoji section headers.**

          â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
          STEP 6 â€” ANALYZE CODE FOR REFERENCES
          â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
          - Based on the issue topic, search the repository code for relevant files, functions,
            classes, or configuration that relate to the issue.
          - If you find relevant code references, add a section at the end of the body:

            ## ðŸ” Relevant Code References
            - \`path/to/file.py\` â€” Brief description of why this file is relevant
            - \`path/to/another.py:L42\` â€” Specific function or line related to this issue

          - If the issue mentions a technology or library, check if it's already used in the project
            and note the current version or usage.
          - Add links to official documentation if they help clarify the issue:

            ## ðŸ“š Useful Documentation
            - [Library Name â€” Topic](https://docs.example.com/relevant-page)

          â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
          STEP 7 â€” ADD CREDIT FOOTER
          â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
          At the very end of the body, add:

          ---
          > âœï¸ *This issue was automatically enhanced by Copilot CLI. Original author: @$ISSUE_AUTHOR*

          â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
          STEP 8 â€” UPDATE THE ISSUE
          â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
          Use the GitHub MCP Server to UPDATE issue #$ISSUE_NUMBER with:
          - The new enhanced title
          - The new enhanced body
          DO NOT create a new issue. UPDATE the existing one.

          â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
          STEP 9 â€” ASSIGN LABELS
          â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
          - From the label list you fetched in Step 2, pick 1-3 labels that best match this issue.
          - Use the GitHub MCP Server to assign those labels to issue #$ISSUE_NUMBER.
          - Every issue MUST have at least one label.

          â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
          STEP 10 â€” ADD A FRIENDLY COMMENT
          â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
          Use the GitHub MCP Server to add a comment on issue #$ISSUE_NUMBER with a brief,
          friendly summary of what was improved. Example:

          > ðŸ¤– **Issue enhanced!** I've improved this issue by:
          > - Translated from Spanish to English
          > - Added a descriptive emoji title
          > - Structured the body with clear sections
          > - Added relevant code references
          >
          > Feel free to edit if anything needs adjusting!

          IMPORTANT GUIDELINES:
          - NEVER change the meaning or intent of the original issue
          - ALWAYS preserve all technical details from the original
          - If the original issue is already well-written in English with good structure, make only minimal improvements
          - Be helpful, not intrusive â€” enhance clarity without adding fluff
          - If the issue body is empty, infer what you can from the title and code analysis, but mark inferred sections clearly
          " --allow-all-tools --model claude-opus-4.6

          echo "âœ… Issue #$ISSUE_NUMBER enhanced successfully"
